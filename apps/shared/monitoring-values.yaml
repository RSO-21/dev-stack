# Shared monitoring config for the Kubernetes cluster.
#
# This deploys Prometheus + Grafana (and the usual Kubernetes exporters) via
# kube-prometheus-stack. It gives you cluster/namespace/pod/node visibility
# immediately; later we can add ServiceMonitors for each microservice.

kube-prometheus-stack:
  grafana:
    enabled: true
    defaultDashboardsEnabled: true
    adminPassword: admin
    service:
      type: ClusterIP
    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
        labelValue: "1"
    additionalDataSources:
      - name: Loki
        type: loki
        access: proxy
        url: http://loki:3100
        isDefault: false

  prometheus:
    prometheusSpec:
      # Allows ServiceMonitors/PodMonitors that don't carry the Helm release label.
      # This makes it easier to add monitoring objects later.
      serviceMonitorSelectorNilUsesHelmValues: false
      podMonitorSelectorNilUsesHelmValues: false

  alertmanager:
    enabled: true
